@page "/login"
@layout BlankLayout

@using WebDevelopment.Client.Components.UIElements
@using WebDevelopment.Client.Interfaces
@using WebDevelopment.Client.Models
@using WebDevelopment.Client.Models.Authentication
@using WebDevelopment.Client.Models.User
@using WebDevelopment.Shared.Interfaces.Authentication

@inject IAuthService AuthService
@inject NavigationManager NavigationManager


@* <div class="d-flex" style="justify-content: center; min-height: 80vh; align-items: center;"> *@
<Card>
        @if (IsRegister)
        {
            <p class="h4 fw-semibold mb-2 text-center">Register</p>

            <EditForm EditContext="@RegisterEditContext" OnValidSubmit="HandleRegister">
                <DataAnnotationsValidator></DataAnnotationsValidator>

                <div class="auth-input-group">
                    <i class="fa fa-user"></i>
                    <InputText placeholder="Name"
                                @bind-Value="RegisterUserModel.Name" />
                </div>
                <ValidationMessage For="(() => RegisterUserModel.Name)" />

                <div class="auth-input-group">
                    <i class="fa fa-user"></i>
                    <InputText placeholder="Surname"
                                @bind-Value="RegisterUserModel.Surname" />
                </div>
                <ValidationMessage For="(() => RegisterUserModel.Surname)" />

                <div class="auth-input-group">
                    <i class="fa fa-user-circle"></i>
                    <InputText placeholder="Username"
                                @bind-Value="RegisterUserModel.UserName" />
                </div>
                <ValidationMessage For="(() => RegisterUserModel.UserName)" />

                <div class="auth-input-group">
                    <i class="fa fa-envelope"></i>
                    <InputText placeholder="Email"
                                @bind-Value="RegisterUserModel.Email" />
                </div>
                <ValidationMessage For="(() => RegisterUserModel.Email)" />

                <div class="auth-input-group">
                    <i class="fa fa-lock"></i>
                    <InputText type="text"
                            placeholder="Password"
                            @bind-value="RegisterUserModel.Password" />
                </div>
                <ValidationMessage For="(() => RegisterUserModel.Password)" />

                <button type="submit" class="auth-btn">
                    Register
                </button>

                @if (!string.IsNullOrEmpty(RegisterErrorMessage))
                {
                    <div class="auth-error">
                        @RegisterErrorMessage
                    </div>
                }
            </EditForm>
        }
        else
        {
            <EditForm Model="@LoginModel" OnValidSubmit="HandleLogin">
                <DataAnnotationsValidator></DataAnnotationsValidator>

                <p class="h4 fw-semibold mb-2 text-center">Sign In</p>

               

                <div class="auth-input-group">
                    <i class="fa-regular fa-circle-user"></i>
                    <InputText placeholder="username" @bind-value="@LoginModel.UserName" ></InputText>
                    @* <input type="text" @bind-value="@LoginModel.UserName" /> *@
                </div>
                        <ValidationMessage For="(() => LoginModel.UserName)" />

                <div class="auth-input-group">
                    <i class="fa fa-lock"></i>
                    <InputText placeholder="password" @bind-value="@LoginModel.Password" ></InputText>
                    @* <input type="text" @bind-value="@LoginModel.Password" /> *@
                </div>
                    <ValidationMessage For="(() => LoginModel.Password)" />

                <button class="auth-btn">
                    Sign In
                </button>

                @if (!string.IsNullOrEmpty(ErrorMessage))
                {
                    <spann class="text-danger fs-13">@ErrorMessage</spann>
                }

            </EditForm>

        }
        <div class="auth-switch">
            @if (IsRegister)
            {
                <span>
                    Already have an account?
                    <a href="javascript:void(0)" @onclick="() => IsRegister = false">
                        Login here
                    </a>
                </span>
            }
            else
            {
                <span>
                    Don’t have an account?
                    <a href="javascript:void(0)" @onclick="() => IsRegister = true">
                        Create one
                    </a>
                </span>
            }
        </div>
        </Card>
@* </div> *@

@code {
    LoginModel LoginModel = new();
    RegisterUserModel RegisterUserModel = new();
    EditContext RegisterEditContext;
    EditContext LoginEditContext;


    private string ErrorMessage = string.Empty;
    private string RegisterErrorMessage = string.Empty;
    private bool IsRegister { get; set; }

    protected override async Task OnInitializedAsync()
    {
        RegisterEditContext = new EditContext(RegisterUserModel);
        LoginEditContext = new EditContext(LoginModel);
    }

    private async Task HandleLogin()
    {
        var isValid = LoginEditContext.Validate();

        if (isValid)
        {
            var response = await AuthService.Login(LoginModel);

            if (response.IsSuccess)
            {
                StateHasChanged();
                NavigationManager.NavigateTo("/", true);
            }
            else
            {
                ErrorMessage = response.Message;
                StateHasChanged();
            }
        }

        StateHasChanged();
    }

    private async Task OnUserNameChange(ChangeEventArgs e)
    {
        LoginModel.UserName = e.Value?.ToString() ?? "";
    }

    private async Task HandleRegister()
    {
        var isValid = RegisterEditContext.Validate();

        if (isValid)
        {
            var response = await AuthService.Register(RegisterUserModel);
            if (response.IsSuccess)
            {
                NavigationManager.NavigateTo("/", true);
            }
            else
            {
                RegisterErrorMessage = response.Message;
            }
        }
        StateHasChanged();
    }
}


<style>
    .up-logo-container {
        top: @(IsRegister ? "-120px" : "-25px");
    }

    .default-card-style {
        width: 600px;
    }

    .auth-input-group {
        position: relative;
        width: 100%;
        margin-bottom: 1rem;
    }

        .auth-input-group i {
            position: absolute;
            top: 50%;
            left: 14px;
            transform: translateY(-50%);
            color: #9aa0a6;
            font-size: 16px;
        }

        .auth-input-group input {
            width: 100%;
            padding: 12px 14px 12px 42px;
            border-radius: 10px;
            border: 1px solid #d0d5dd;
            font-size: 15px;
            outline: none;
            transition: all 0.2s ease;
            background-color: #fff;
        }

            .auth-input-group input::placeholder {
                color: #9aa0a6;
            }

            .auth-input-group input:focus {
                border-color: #1563b1;
                box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.15);
            }

                .auth-input-group input:focus + i,
                .auth-input-group input:focus ~ i {
                    color: #1563b1;
                }

    .auth-btn {
        width: 100%;
        padding: 12px;
        background: #1563b1;
        border: none;
        border-radius: 10px;
        color: #fff;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s ease;
    }

        .auth-btn:hover {
            background: #0f4c8a;
        }

    .auth-switch {
        text-align: center;
        margin-top: 1.25rem;
        font-size: 14px;
        color: #6b7280;
    }

        .auth-switch a {
            color: #1563b1;
            font-weight: 600;
            margin-left: 4px;
            text-decoration: none;
            cursor: pointer;
        }

            .auth-switch a:hover {
                text-decoration: underline;
            }

</style>
